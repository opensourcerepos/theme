{"componentChunkName":"component---opensourcerepos-theme-src-pages-blog-js","path":"/understanding-the-source-code-of-redux-redux-js/","webpackCompilationHash":"ad53e7332775a4c33fa4","result":{"pageContext":{"isCreatedByStatefulCreatePages":false,"html":"<h1 id=\"introduction\"><a href=\"#introduction\" aria-label=\"introduction permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Introduction</h1>\n<p>Redux is a predictable state container for Javascript apps. You can store the state of your application using Redux. Redux provides some core functions for allowing you to access the state and write to state, and other helper functions which allow you to combine reducers, bind actions, etc. </p>\n<p>There are many folders that you will find when you open the Redux repository. The main source code of Redux lies in the \"src\" folder. We are going to focus on the \"src\" folder in this blog post.</p>\n<h1 id=\"source-folder\"><a href=\"#source-folder\" aria-label=\"source folder permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Source folder</h1>\n<p>If you open the \"src\" folder, you will find the following files.</p>\n<h2 id=\"indexjs-file\"><a href=\"#indexjs-file\" aria-label=\"indexjs file permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>index.js file</h2>\n<p>The index.js file exports all the functions from other files. It also checks if you are using the development version of redux in production code without setting the environment variable NODE<em>ENV as \"production\". In simple terms, if you have not set NODE</em>ENV as production, but if your code is still minified, then it means that the Redux source code will be in development mode. So in index.js file, they have written a function called \"isCrushed\". </p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">isCrushed</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>\n  process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">NODE_ENV</span> <span class=\"token operator\">!==</span> <span class=\"token string\">'production'</span> <span class=\"token operator\">&amp;&amp;</span>\n  <span class=\"token keyword\">typeof</span> isCrushed<span class=\"token punctuation\">.</span>name <span class=\"token operator\">===</span> <span class=\"token string\">'string'</span> <span class=\"token operator\">&amp;&amp;</span>\n  isCrushed<span class=\"token punctuation\">.</span>name <span class=\"token operator\">!==</span> <span class=\"token string\">'isCrushed'</span>\n<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">warning</span><span class=\"token punctuation\">(</span>\n    <span class=\"token string\">'You are currently using minified code outside of NODE_ENV === \"production\". '</span> <span class=\"token operator\">+</span>\n      <span class=\"token string\">'This means that you are running a slower development build of Redux. '</span> <span class=\"token operator\">+</span>\n      <span class=\"token string\">'You can use loose-envify (https://github.com/zertosh/loose-envify) for browserify '</span> <span class=\"token operator\">+</span>\n      <span class=\"token string\">'or setting mode to production in webpack (https://webpack.js.org/concepts/mode/) '</span> <span class=\"token operator\">+</span>\n      <span class=\"token string\">'to ensure you have the correct code for your production build.'</span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>When you are using the minified code, the function name of \"isCrushed\" will be obfuscated to something smaller. But if you have not set NODE<em>ENV as production, Redux will not know that it has to include minified code. So you will be using development build of Redux. The above warning is to check for that edge case where you have forgotten to set the NODE</em>ENV as production when actually you are using the minified code in your build (Usually people use minified code in production builds)</p>\n<h2 id=\"createstorejs\"><a href=\"#createstorejs\" aria-label=\"createstorejs permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>createStore.js</h2>\n<p>This is one of the main files of the Redux repository. It is a simple function, which exports 4 functions. The map of this file looks something like this.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">export default function createStore(reducer, preloadedState, enhancer) {\n    function getState() {\n       ...\n    }\n\n    function subscribe(listener) {\n       ...\n    }\n\n    function dispatch(action) {\n       ...\n    }\n\n    function replaceReducer(nextReducer) {\n       ...\n    }\n\n    function observable() {\n       ...\n    }\n\n    return {\n        dispatch,\n        subscribe,\n        getState,\n        replaceReducer,\n        [$$observable]: observable\n    }\n}</code></pre></div>\n<h2 id=\"getstate-function\"><a href=\"#getstate-function\" aria-label=\"getstate function permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>getState function</h2>\n<p>The getState function returns the currentState of the application. It checks if the current state is isDispatching, and if it is, then throws the error. isDispatching is a kind of lock that we have in the database. When the redux is updating the state (in dispatch function), it sets isDispatching to true, and only when the state is completely updated, it sets isDispatching back to false. This check-in getState is to prevent return inconsistent state when it is being updated.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">getState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>isDispatching<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span>\n        <span class=\"token string\">'You may not call store.subscribe() while the reducer is executing. '</span> <span class=\"token operator\">+</span>\n          <span class=\"token string\">'If you would like to be notified after the store has been updated, subscribe from a '</span> <span class=\"token operator\">+</span>\n          <span class=\"token string\">'component and invoke store.getState() in the callback to access the latest state. '</span> <span class=\"token operator\">+</span>\n          <span class=\"token string\">'See https://redux.js.org/api-reference/store#subscribe(listener) for more details.'</span>\n      <span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token keyword\">return</span> currentState\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"subscribe-function\"><a href=\"#subscribe-function\" aria-label=\"subscribe function permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>subscribe function</h2>\n<p>The subscribe function accepts a listener function as a parameter and adds it to an array of list of listeners called nextListeners. This array of functions is called whenever the state changes. It also returns the unsubscribe function, which can be used to remove the function from the array of functions (nextListeners). The pseudo-code of the subscribe function is as follows</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">listnerFunction</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span> <span class=\"token operator\">...</span> <span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">const</span> res <span class=\"token operator\">=</span> redux<span class=\"token punctuation\">.</span><span class=\"token function\">subscribe</span><span class=\"token punctuation\">(</span>listnerFunction<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token operator\">...</span>\n<span class=\"token comment\">// when you want to remove the listnerFunction</span>\nres<span class=\"token punctuation\">.</span><span class=\"token function\">unsubscribe</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"dispatch-function\"><a href=\"#dispatch-function\" aria-label=\"dispatch function permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>dispatch function</h2>\n<p>The dispatch function dispatches an action, which is used to change the state. The pseudo-code of dispatch function, after removing the checks that they have written is as follows.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">dispatch</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">action</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n      isDispatching <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span>\n      currentState <span class=\"token operator\">=</span> <span class=\"token function\">currentReducer</span><span class=\"token punctuation\">(</span>currentState<span class=\"token punctuation\">,</span> action<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">{</span>\n      isDispatching <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">const</span> listeners <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>currentListeners <span class=\"token operator\">=</span> nextListeners<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> listeners<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> listener <span class=\"token operator\">=</span> listeners<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span>\n      <span class=\"token function\">listener</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">return</span> action\n  <span class=\"token punctuation\">}</span></code></pre></div>\n<p>Here we set isDispatching to true (if you call getState when isDispatching is true, it throws an error instead of returning state). Then we pass the currentState and action to the currentReducer function, which returns a new state, which is again assigned to currentState. After that, the isDispatching is set to false again.</p>\n<p>Also, after the state is changed, all the listener functions from the nextListeners array are called. </p>\n<h2 id=\"replacereducer-function\"><a href=\"#replacereducer-function\" aria-label=\"replacereducer function permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>replaceReducer function</h2>\n<p>In replaceReducer function, as the name suggests, it replaces the currentReducer with the new reducer function passed in the parameter of the function. It also dispatches an internal action called \"REPLACE\", so that the currentState is updated with new state and all listener functions are notified.</p>\n<p>The observable function allows you to observe for the changes in state. Whenever the state is changed, the function that is subscribed to observing it is called. Observables are different from promises. In promises, the function is resolved once. But in observables, the observed function is called whenever the function is resolved. </p>\n<p>The createStore also dispatched an internal state called INIT when it is called. </p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">dispatch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> type<span class=\"token punctuation\">:</span> ActionTypes<span class=\"token punctuation\">.</span><span class=\"token constant\">INIT</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h1 id=\"conclusion\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusion</h1>\n<p>We have looked into two important files \"index.js\" and \"createStore.js\". We will look into other source files in another blog post.</p>","fileAbsolutePath":"/Users/santosh/Projects/opensourcerepos/opensourcerepos-theme/test-theme/src/repository-blogs/understanding-the-source-code-of-redux-redux-js.md","frontmatter":{"title":"Understanding the source code of Redux (ReduxJS)","date":"July 23, 2019","versionControl":"GitHub","repositoryUrl":"https://github.com/reduxjs/redux","repoOrganization":"reduxjs","repoName":"redux","author":"sant0shg"},"excerpt":"Introduction Redux is a predictable state container for Javascript apps. You can store the state of your application using Redux. Reduxâ€¦","tableOfContents":"<ul>\n<li><a href=\"/understanding-the-source-code-of-redux-redux-js/#introduction\">Introduction</a></li>\n<li>\n<p><a href=\"/understanding-the-source-code-of-redux-redux-js/#source-folder\">Source folder</a></p>\n<ul>\n<li><a href=\"/understanding-the-source-code-of-redux-redux-js/#indexjs-file\">index.js file</a></li>\n<li><a href=\"/understanding-the-source-code-of-redux-redux-js/#createstorejs\">createStore.js</a></li>\n<li><a href=\"/understanding-the-source-code-of-redux-redux-js/#getstate-function\">getState function</a></li>\n<li><a href=\"/understanding-the-source-code-of-redux-redux-js/#subscribe-function\">subscribe function</a></li>\n<li><a href=\"/understanding-the-source-code-of-redux-redux-js/#dispatch-function\">dispatch function</a></li>\n<li><a href=\"/understanding-the-source-code-of-redux-redux-js/#replacereducer-function\">replaceReducer function</a></li>\n</ul>\n</li>\n<li><a href=\"/understanding-the-source-code-of-redux-redux-js/#conclusion\">Conclusion</a></li>\n</ul>","fields":{"slug":"/understanding-the-source-code-of-redux-redux-js/"},"timeToRead":4}}}